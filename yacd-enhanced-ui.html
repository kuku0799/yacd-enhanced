<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yacd Enhanced</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); 
            color: #fff; 
            min-height: 100vh;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: rgba(42, 42, 42, 0.95); 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.3); 
            backdrop-filter: blur(10px);
        }
        .header { 
            text-align: center; 
            margin-bottom: 40px; 
            border-bottom: 3px solid #007bff; 
            padding-bottom: 20px; 
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            background: linear-gradient(45deg, #007bff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .feature { 
            margin: 25px 0; 
            padding: 25px; 
            border: 1px solid #444; 
            border-radius: 12px; 
            background: rgba(51, 51, 51, 0.8); 
            transition: all 0.3s ease;
        }
        .feature:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border-color: #007bff;
        }
        .btn { 
            display: inline-block; 
            padding: 12px 24px; 
            background: linear-gradient(45deg, #007bff, #0056b3); 
            color: white; 
            text-decoration: none; 
            border-radius: 8px; 
            margin: 8px; 
            border: none; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        .btn:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.4);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .btn-danger { 
            background: linear-gradient(45deg, #dc3545, #c82333); 
            box-shadow: 0 4px 15px rgba(220,53,69,0.3);
        }
        .btn-danger:hover { 
            box-shadow: 0 6px 20px rgba(220,53,69,0.4);
        }
        .btn-success { 
            background: linear-gradient(45deg, #28a745, #218838); 
            box-shadow: 0 4px 15px rgba(40,167,69,0.3);
        }
        .btn-success:hover { 
            box-shadow: 0 6px 20px rgba(40,167,69,0.4);
        }
        .code { 
            background: #1e1e1e; 
            padding: 12px; 
            border-radius: 6px; 
            font-family: 'Courier New', monospace; 
            color: #00ff00; 
            border: 1px solid #333;
            display: block;
            margin: 10px 0;
        }
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #444;
            background: rgba(51, 51, 51, 0.5);
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }
        .tab {
            padding: 15px 25px;
            background: transparent;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }
        .tab:hover {
            background: rgba(0,123,255,0.2);
        }
        .tab.active {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(51, 51, 51, 0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #444;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #aaa;
            margin-top: 5px;
        }
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
        }
        .input-group textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 6px;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
        }
        .input-group textarea:focus {
            outline: none;
            border-color: #007bff;
        }
        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        .alert-success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
            color: #28a745;
        }
        .alert-error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            color: #dc3545;
        }
        .alert-info {
            background: rgba(0, 123, 255, 0.2);
            border: 1px solid #007bff;
            color: #007bff;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .node-list {
            max-height: 300px;
            overflow-y: auto;
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 10px;
        }
        .node-item {
            padding: 8px;
            margin: 4px 0;
            background: rgba(51, 51, 51, 0.8);
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #2a2a2a;
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Yacd Enhanced</h1>
            <p>æ™ºèƒ½èŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿ - ä¸“ä¸ºOpenWrtä¼˜åŒ–</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">ğŸ“Š æ¦‚è§ˆ</button>
            <button class="tab" onclick="showTab('nodes')">ğŸ”— èŠ‚ç‚¹ç®¡ç†</button>
            <button class="tab" onclick="showTab('commands')">âš™ï¸ å‘½ä»¤å·¥å…·</button>
            <button class="tab" onclick="showTab('status')">ğŸ“ˆ ç³»ç»ŸçŠ¶æ€</button>
        </div>
        
        <div id="overview" class="tab-content active">
            <div class="feature">
                <h3>âœ¨ æ ¸å¿ƒåŠŸèƒ½</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">4</div>
                        <div class="stat-label">åè®®æ”¯æŒ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="overview-node-count">-</div>
                        <div class="stat-label">èŠ‚ç‚¹æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">24/7</div>
                        <div class="stat-label">è‡ªåŠ¨ç›‘æ§</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">100%</div>
                        <div class="stat-label">å…¼å®¹æ€§</div>
                    </div>
                </div>
                <ul>
                    <li>ğŸ¯ å¯è§†åŒ–èŠ‚ç‚¹ç®¡ç†ç•Œé¢</li>
                    <li>ğŸ”— å¤šåè®®æ”¯æŒ (VMess/SS/Trojan/VLESS)</li>
                    <li>âœ… æ™ºèƒ½èŠ‚ç‚¹éªŒè¯å’Œè¿‡æ»¤</li>
                    <li>ğŸ“Š å®æ—¶ç»Ÿè®¡æ˜¾ç¤º</li>
                    <li>ğŸ“ æ–‡ä»¶å¯¼å…¥å¯¼å‡ºåŠŸèƒ½</li>
                    <li>ğŸ”„ è‡ªåŠ¨ç›‘æ§å’Œæ›´æ–°</li>
                </ul>
            </div>
            
            <div class="feature">
                <h3>ğŸ“‹ å¿«é€Ÿå¼€å§‹</h3>
                <p>è®¿é—®åœ°å€ï¼š<span class="code">http://æ‚¨çš„è·¯ç”±å™¨IP:9090/ui/yacd/</span></p>
                <p>åœ¨ç›‘æ§é¢æ¿ä¸­é€‰æ‹©"èŠ‚ç‚¹ç®¡ç†"æ ‡ç­¾é¡µå¼€å§‹ä½¿ç”¨</p>
            </div>
        </div>
        
        <div id="nodes" class="tab-content">
            <div class="feature">
                <h3>ğŸ“ èŠ‚ç‚¹ç®¡ç†</h3>
                <p>æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç®¡ç†èŠ‚ç‚¹ï¼š</p>
                <button class="btn" onclick="showNodeEditor()">ğŸ“ ç¼–è¾‘èŠ‚ç‚¹æ–‡ä»¶</button>
                <button class="btn" onclick="loadNodes()">ğŸ‘ï¸ æŸ¥çœ‹å½“å‰èŠ‚ç‚¹</button>
                <button class="btn btn-success" onclick="updateNodes()">ğŸ”„ æ›´æ–°èŠ‚ç‚¹</button>
                <button class="btn btn-danger" onclick="clearNodes()">ğŸ—‘ï¸ æ¸…ç©ºèŠ‚ç‚¹</button>
            </div>
            
            <div class="feature">
                <h3>ğŸ“ æ–‡ä»¶ä½ç½®</h3>
                <p>èŠ‚ç‚¹æ–‡ä»¶ï¼š<span class="code">/root/OpenClashManage/wangluo/nodes.txt</span></p>
                <p>æ—¥å¿—æ–‡ä»¶ï¼š<span class="code">/root/OpenClashManage/wangluo/log.txt</span></p>
                <p>è„šæœ¬ç›®å½•ï¼š<span class="code">/root/OpenClashManage/scripts/</span></p>
            </div>
            
            <div class="feature">
                <h3>ğŸ”— æ”¯æŒçš„èŠ‚ç‚¹æ ¼å¼</h3>
                <ul>
                    <li><span class="code">vmess://base64ç¼–ç é…ç½®</span></li>
                    <li><span class="code">ss://base64ç¼–ç é…ç½®</span></li>
                    <li><span class="code">trojan://å¯†ç @æœåŠ¡å™¨:ç«¯å£?security=tls&type=tcp#å¤‡æ³¨</span></li>
                    <li><span class="code">vless://uuid@æœåŠ¡å™¨:ç«¯å£?encryption=none&security=tls&type=tcp#å¤‡æ³¨</span></li>
                </ul>
            </div>
            
            <div id="node-list-container" class="feature" style="display: none;">
                <h3>ğŸ“‹ å½“å‰èŠ‚ç‚¹åˆ—è¡¨</h3>
                <div id="node-list" class="node-list"></div>
            </div>
        </div>
        
        <div id="commands" class="tab-content">
            <div class="feature">
                <h3>âš™ï¸ å¸¸ç”¨å‘½ä»¤</h3>
                <button class="btn" onclick="executeCommand('nano /root/OpenClashManage/wangluo/nodes.txt')">ğŸ“ ç¼–è¾‘èŠ‚ç‚¹æ–‡ä»¶</button>
                <button class="btn" onclick="executeCommand('cat /root/OpenClashManage/wangluo/nodes.txt')">ğŸ‘ï¸ æŸ¥çœ‹èŠ‚ç‚¹</button>
                <button class="btn btn-success" onclick="executeCommand('python3 /root/OpenClashManage/scripts/zr.py')">ğŸ”„ æ›´æ–°èŠ‚ç‚¹</button>
                <button class="btn" onclick="executeCommand('/etc/init.d/yacd-enhanced-monitor status')">ğŸ“Š ç›‘æ§çŠ¶æ€</button>
                <button class="btn" onclick="executeCommand('/etc/init.d/openclash restart')">ğŸ”„ é‡å¯OpenClash</button>
                <button class="btn" onclick="executeCommand('tail -f /root/OpenClashManage/wangluo/log.txt')">ğŸ“‹ æŸ¥çœ‹æ—¥å¿—</button>
                <button class="btn btn-danger" onclick="executeCommand('echo "" > /root/OpenClashManage/wangluo/nodes.txt')">ğŸ—‘ï¸ æ¸…ç©ºèŠ‚ç‚¹</button>
            </div>
            
            <div class="feature">
                <h3>ğŸ”§ æœåŠ¡ç®¡ç†</h3>
                <button class="btn" onclick="startMonitor()">â–¶ï¸ å¯åŠ¨ç›‘æ§</button>
                <button class="btn" onclick="stopMonitor()">â¹ï¸ åœæ­¢ç›‘æ§</button>
                <button class="btn" onclick="restartMonitor()">ğŸ”„ é‡å¯ç›‘æ§</button>
                <button class="btn" onclick="getMonitorStatus()">ğŸ“Š ç›‘æ§çŠ¶æ€</button>
            </div>
        </div>
        
        <div id="status" class="tab-content">
            <div class="feature">
                <h3>ğŸ“ˆ ç³»ç»ŸçŠ¶æ€</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="node-count">-</div>
                        <div class="stat-label">èŠ‚ç‚¹æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="monitor-status">-</div>
                        <div class="stat-label">ç›‘æ§çŠ¶æ€</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="openclash-status">-</div>
                        <div class="stat-label">OpenClashçŠ¶æ€</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="nginx-status">-</div>
                        <div class="stat-label">NginxçŠ¶æ€</div>
                    </div>
                </div>
                <button class="btn" onclick="refreshStatus()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
            </div>
        </div>
    </div>
    
    <!-- èŠ‚ç‚¹ç¼–è¾‘å™¨æ¨¡æ€æ¡† -->
    <div id="nodeEditorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNodeEditor()">&times;</span>
            <h3>ğŸ“ ç¼–è¾‘èŠ‚ç‚¹</h3>
            <div class="input-group">
                <label for="nodeContent">èŠ‚ç‚¹å†…å®¹ï¼ˆæ¯è¡Œä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼š</label>
                <textarea id="nodeContent" placeholder="è¯·è¾“å…¥èŠ‚ç‚¹é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ª..."></textarea>
            </div>
            <button class="btn btn-success" onclick="saveNodes()">ğŸ’¾ ä¿å­˜èŠ‚ç‚¹</button>
            <button class="btn" onclick="closeNodeEditor()">âŒ å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- å‘½ä»¤æ‰§è¡Œç»“æœæ¨¡æ€æ¡† -->
    <div id="commandModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCommandModal()">&times;</span>
            <h3>ğŸ“‹ å‘½ä»¤æ‰§è¡Œç»“æœ</h3>
            <div id="commandResult" class="code"></div>
            <button class="btn" onclick="closeCommandModal()">ç¡®å®š</button>
        </div>
    </div>
    
    <script>
        // APIåŸºç¡€URL
        const API_BASE = 'http://localhost:5000/api';
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            // æ’å…¥åˆ°é¡µé¢é¡¶éƒ¨
            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }
        
        // APIè¯·æ±‚å‡½æ•°
        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('APIè¯·æ±‚å¤±è´¥:', error);
                showMessage(`APIè¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }
        
        // æ˜¾ç¤ºæ ‡ç­¾é¡µ
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            var contents = document.getElementsByClassName('tab-content');
            for (var i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            var tabs = document.getElementsByClassName('tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // å¦‚æœåˆ‡æ¢åˆ°çŠ¶æ€æ ‡ç­¾ï¼Œè‡ªåŠ¨åˆ·æ–°çŠ¶æ€
            if (tabName === 'status') {
                refreshStatus();
            }
        }
        
        // åŠ è½½èŠ‚ç‚¹åˆ—è¡¨
        async function loadNodes() {
            try {
                const result = await apiRequest('/nodes');
                if (result.success) {
                    const container = document.getElementById('node-list-container');
                    const list = document.getElementById('node-list');
                    
                    if (result.nodes && result.nodes.length > 0) {
                        list.innerHTML = result.nodes.map(node => 
                            `<div class="node-item">${node}</div>`
                        ).join('');
                        container.style.display = 'block';
                        showMessage(`æˆåŠŸåŠ è½½ ${result.count} ä¸ªèŠ‚ç‚¹`, 'success');
                    } else {
                        list.innerHTML = '<div class="node-item">æš‚æ— èŠ‚ç‚¹</div>';
                        container.style.display = 'block';
                        showMessage('èŠ‚ç‚¹åˆ—è¡¨ä¸ºç©º', 'info');
                    }
                } else {
                    showMessage(`åŠ è½½èŠ‚ç‚¹å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('åŠ è½½èŠ‚ç‚¹å¤±è´¥', 'error');
            }
        }
        
        // æ˜¾ç¤ºèŠ‚ç‚¹ç¼–è¾‘å™¨
        async function showNodeEditor() {
            try {
                const result = await apiRequest('/nodes');
                if (result.success) {
                    document.getElementById('nodeContent').value = result.nodes.join('\n');
                    document.getElementById('nodeEditorModal').style.display = 'block';
                } else {
                    showMessage(`è·å–èŠ‚ç‚¹å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('è·å–èŠ‚ç‚¹å¤±è´¥', 'error');
            }
        }
        
        // å…³é—­èŠ‚ç‚¹ç¼–è¾‘å™¨
        function closeNodeEditor() {
            document.getElementById('nodeEditorModal').style.display = 'none';
        }
        
        // ä¿å­˜èŠ‚ç‚¹
        async function saveNodes() {
            const content = document.getElementById('nodeContent').value;
            const nodes = content.split('\n').filter(line => line.trim());
            
            try {
                const result = await apiRequest('/nodes', {
                    method: 'POST',
                    body: JSON.stringify({ nodes: nodes })
                });
                
                if (result.success) {
                    showMessage(result.message || 'èŠ‚ç‚¹ä¿å­˜æˆåŠŸ', 'success');
                    closeNodeEditor();
                    loadNodes();
                } else {
                    showMessage(`ä¿å­˜èŠ‚ç‚¹å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('ä¿å­˜èŠ‚ç‚¹å¤±è´¥', 'error');
            }
        }
        
        // æ›´æ–°èŠ‚ç‚¹
        async function updateNodes() {
            try {
                const result = await apiRequest('/nodes/update', {
                    method: 'POST'
                });
                
                if (result.success) {
                    showMessage('èŠ‚ç‚¹æ›´æ–°æˆåŠŸ', 'success');
                } else {
                    showMessage(`æ›´æ–°èŠ‚ç‚¹å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('æ›´æ–°èŠ‚ç‚¹å¤±è´¥', 'error');
            }
        }
        
        // æ¸…ç©ºèŠ‚ç‚¹
        async function clearNodes() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰èŠ‚ç‚¹å—ï¼Ÿ')) {
                return;
            }
            
            try {
                const result = await apiRequest('/nodes', {
                    method: 'DELETE'
                });
                
                if (result.success) {
                    showMessage('èŠ‚ç‚¹å·²æ¸…ç©º', 'success');
                    loadNodes();
                } else {
                    showMessage(`æ¸…ç©ºèŠ‚ç‚¹å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('æ¸…ç©ºèŠ‚ç‚¹å¤±è´¥', 'error');
            }
        }
        
        // æ‰§è¡Œå‘½ä»¤
        async function executeCommand(command) {
            try {
                const result = await apiRequest('/system/command', {
                    method: 'POST',
                    body: JSON.stringify({ command: command })
                });
                
                if (result.success) {
                    document.getElementById('commandResult').textContent = result.output || 'å‘½ä»¤æ‰§è¡ŒæˆåŠŸ';
                } else {
                    document.getElementById('commandResult').textContent = result.error || 'å‘½ä»¤æ‰§è¡Œå¤±è´¥';
                }
                
                document.getElementById('commandModal').style.display = 'block';
            } catch (error) {
                showMessage('æ‰§è¡Œå‘½ä»¤å¤±è´¥', 'error');
            }
        }
        
        // å…³é—­å‘½ä»¤æ¨¡æ€æ¡†
        function closeCommandModal() {
            document.getElementById('commandModal').style.display = 'none';
        }
        
        // å¯åŠ¨ç›‘æ§
        async function startMonitor() {
            try {
                const result = await apiRequest('/monitor/start', {
                    method: 'POST'
                });
                
                if (result.success) {
                    showMessage('ç›‘æ§æœåŠ¡å¯åŠ¨æˆåŠŸ', 'success');
                } else {
                    showMessage(`å¯åŠ¨ç›‘æ§å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('å¯åŠ¨ç›‘æ§å¤±è´¥', 'error');
            }
        }
        
        // åœæ­¢ç›‘æ§
        async function stopMonitor() {
            try {
                const result = await apiRequest('/monitor/stop', {
                    method: 'POST'
                });
                
                if (result.success) {
                    showMessage('ç›‘æ§æœåŠ¡åœæ­¢æˆåŠŸ', 'success');
                } else {
                    showMessage(`åœæ­¢ç›‘æ§å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('åœæ­¢ç›‘æ§å¤±è´¥', 'error');
            }
        }
        
        // é‡å¯ç›‘æ§
        async function restartMonitor() {
            try {
                const result = await apiRequest('/monitor/restart', {
                    method: 'POST'
                });
                
                if (result.success) {
                    showMessage('ç›‘æ§æœåŠ¡é‡å¯æˆåŠŸ', 'success');
                } else {
                    showMessage(`é‡å¯ç›‘æ§å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('é‡å¯ç›‘æ§å¤±è´¥', 'error');
            }
        }
        
        // è·å–ç›‘æ§çŠ¶æ€
        async function getMonitorStatus() {
            try {
                const result = await apiRequest('/monitor/status');
                
                if (result.success) {
                    showMessage(`ç›‘æ§çŠ¶æ€: ${result.output}`, 'info');
                } else {
                    showMessage(`è·å–ç›‘æ§çŠ¶æ€å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('è·å–ç›‘æ§çŠ¶æ€å¤±è´¥', 'error');
            }
        }
        
        // åˆ·æ–°ç³»ç»ŸçŠ¶æ€
        async function refreshStatus() {
            try {
                const result = await apiRequest('/system/status');
                
                if (result.success) {
                    const status = result.status;
                    document.getElementById('node-count').textContent = status.node_count || 0;
                    document.getElementById('monitor-status').textContent = status.monitor_status || 'æœªçŸ¥';
                    document.getElementById('openclash-status').textContent = status.openclash_status || 'æœªçŸ¥';
                    document.getElementById('nginx-status').textContent = status.nginx_status || 'æœªçŸ¥';
                    
                    // æ›´æ–°æ¦‚è§ˆé¡µé¢çš„èŠ‚ç‚¹æ•°é‡
                    document.getElementById('overview-node-count').textContent = status.node_count || 0;
                } else {
                    showMessage(`è·å–ç³»ç»ŸçŠ¶æ€å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('è·å–ç³»ç»ŸçŠ¶æ€å¤±è´¥', 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            refreshStatus();
            loadNodes();
        };
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const nodeModal = document.getElementById('nodeEditorModal');
            const commandModal = document.getElementById('commandModal');
            
            if (event.target === nodeModal) {
                closeNodeEditor();
            }
            if (event.target === commandModal) {
                closeCommandModal();
            }
        };
    </script>
</body>
</html> 